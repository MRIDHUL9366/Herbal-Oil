<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Himalayan Herbal Oil - Booking</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #2d5016;
      --primary-light: #4a7c2a;
      --secondary: #d4af37;
      --accent: #8b4513;
      --light: #f9fbf7;
      --dark: #1a1a1a;
      --gray: #6b7280;
      --gray-light: #e6e9ef;
      --border-radius: 12px;
      --shadow: 0 6px 18px rgba(20, 24, 40, 0.08);
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', system-ui, Arial, sans-serif;
      background: linear-gradient(135deg, #f9fbf7 0%, #e8f5e8 100%);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px 0;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px;
    }

    .card {
      background: #fff;
      border-radius: var(--border-radius);
      padding: 28px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(45, 80, 22, 0.1);
      transition: var(--transition);
      margin-bottom: 24px;
      height: 100%;
    }

    .card:hover {
      box-shadow: 0 10px 25px rgba(20, 24, 40, 0.12);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--gray-light);
      position: relative;
    }

    .header::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--secondary);
    }

    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 28px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 8px;
    }

    h2 {
      font-family: 'Playfair Display', serif;
      font-size: 22px;
      font-weight: 500;
      color: var(--primary);
      margin-bottom: 20px;
    }

    h3 {
      font-family: 'Playfair Display', serif;
      font-size: 18px;
      font-weight: 500;
      color: var(--primary);
      margin-bottom: 15px;
    }

    .subtitle {
      color: var(--gray);
      font-size: 16px;
    }

    label {
      display: block;
      margin-top: 18px;
      font-weight: 500;
      color: var(--primary);
      font-size: 15px;
    }

    input, textarea, select {
      width: 100%;
      padding: 14px 16px;
      border-radius: 10px;
      border: 1px solid var(--gray-light);
      background: #fff;
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      transition: var(--transition);
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(45, 80, 22, 0.1);
    }

    .readonly-field {
      background-color: #f8f9fa;
      color: var(--gray);
    }

    .quantity-control {
      display: flex;
      align-items: center;
      margin-top: 8px;
    }

    .quantity-control button {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      border: 1px solid var(--gray-light);
      background: #fff;
      font-size: 18px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }

    .quantity-control button:hover {
      background: var(--primary-light);
      color: white;
      border-color: var(--primary-light);
    }

    .quantity-control input {
      width: 70px;
      margin: 0 10px;
      text-align: center;
      padding: 10px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px dashed var(--gray-light);
    }

    .total {
      font-weight: 700;
      font-size: 20px;
      color: var(--primary);
      margin-top: 10px;
      padding-top: 15px;
      border-top: 2px solid var(--secondary);
    }

    .buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
    }

    button {
      padding: 14px 20px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 16px;
      transition: var(--transition);
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-back {
      background: #f3f4f6;
      color: var(--dark);
      border: 1px solid var(--gray-light);
    }

    .btn-back:hover {
      background: #e5e7eb;
    }

    .btn-pay {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 4px 12px rgba(45, 80, 22, 0.3);
    }

    .btn-pay:hover {
      background: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(45, 80, 22, 0.4);
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .compact-roadmap {
      display: flex;
      justify-content: space-between;
      margin: 25px 0;
      position: relative;
      padding: 0 10px;
    }

    .compact-roadmap::before {
      content: '';
      position: absolute;
      top: 16px;
      left: 20px;
      right: 20px;
      height: 2px;
      background: var(--gray-light);
      z-index: 1;
    }

    .compact-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 2;
      flex: 1;
    }

    .compact-step-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: white;
      border: 2px solid var(--gray-light);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
      transition: var(--transition);
      position: relative;
      font-size: 14px;
    }

    .compact-step-icon.active {
      border-color: var(--primary);
      background: var(--primary);
      color: white;
      animation: pulse 2s infinite ease-in-out;
    }

    .compact-step-icon.completed {
      border-color: var(--primary);
      background: var(--primary);
      color: white;
    }

    .compact-step-icon.completed::after {
      content: '‚úì';
      font-weight: bold;
    }

    .compact-step-label {
      font-weight: 500;
      font-size: 12px;
      text-align: center;
    }

    .compact-step-label.active {
      color: var(--primary);
      font-weight: 600;
    }

    .booking-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      align-items: stretch;
    }

    @media (max-width: 768px) {
      .booking-container {
        grid-template-columns: 1fr;
      }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="card">
      <div class="header">
        <div class="logo">
          <div class="logo-icon">H</div>
          <h1>Himalayan Herbal Oil</h1>
        </div>
        <p class="subtitle">Pure Ayurvedic formulation from the Himalayas</p>
      </div>
    </div>

    <!-- Booking Form -->
    <div class="booking-container">
      <!-- Left side booking form -->
      <div class="card">
        <h2>Booking Details</h2>

        <!-- Compact Process Roadmap -->
        <div class="compact-roadmap">
          <div class="compact-step">
            <div class="compact-step-icon active">üìç</div>
            <span class="compact-step-label active">Booking</span>
          </div>
          <div class="compact-step">
            <div class="compact-step-icon">üí≥</div>
            <span class="compact-step-label">Payment</span>
          </div>
          <div class="compact-step">
            <div class="compact-step-icon">üì¶</div>
            <span class="compact-step-label">Packing</span>
          </div>
          <div class="compact-step">
            <div class="compact-step-icon">üöö</div>
            <span class="compact-step-label">Delivery</span>
          </div>
        </div>

        <div>
          <label for="oilSize">Oil Size</label>
          <input type="text" id="oilSize" name="oilSize" value="350ml" class="readonly-field" readonly>
        </div>

        <div>
          <label for="oilPrice">Price (‚Çπ)</label>
          <input type="text" id="oilPrice" name="oilPrice" value="{{ product.price }}" class="readonly-field" readonly>
        </div>

        <div>
          <label for="qty">Quantity</label>
          <div class="quantity-control">
            <button id="decreaseQty">-</button>
            <input id="qty" name="qty" type="number" min="1" value="{{booking_data.qty|default:'1' }}">
            <button id="increaseQty">+</button>
          </div>
        </div>

        <div>
          <label for="notes">Special Instructions (optional)</label>
          <textarea id="notes" name="notes" rows="3" placeholder="Any special requirements or notes...">{{ booking_data.notes|default:''}}</textarea>
        </div>
      </div>

      <!-- Right side customer booking address details -->
      <div class="card">
        <h2>Customer Details</h2>
       <form method="post" action="{% url 'booking_confirmation' %}">
                {% csrf_token %}

                <label for="custName">Full Name</label>
                <input type="text" id="custName" name="custName"
                       value="{{ user.first_name|default:'' }}"
                       placeholder="Enter your name" readonly>

                <label for="custEmail">Email</label>
                <input type="email" id="custEmail" name="custEmail"
                       value="{{ user.email|default:'' }}"
                       placeholder="Enter your email" readonly>

                <label for="custPhone">Phone</label>
                <input type="text" id="custPhone" name="custPhone"
                       value="{{ user.customer.mobile_no|default:'' }}"
                       placeholder="Enter your phone number" readonly>

                <label for="addPhone">Alternate Phone</label>
                <input type="text" id="addPhone" name="addPhone"
                       placeholder="Enter your second number" value="{{ booking_data.addPhone|default:'' }}">

                <label for="custAddress">Delivery Address</label>
                <textarea id="custAddress" name="custAddress" rows="3"
                          placeholder="Enter your complete address">{{ booking_data.custAddress|default:'' }}</textarea>

                <div class="summary-row">
                    <span>Product Price</span>
                    <span id="productPrice">‚Çπ850</span>
                </div>
                <div class="summary-row total">
                    <span>Total Amount</span>
                    <span id="totalPrice">‚Çπ850</span>
                </div>

                <!-- Hidden inputs to store JS-calculated data -->
                <input type="hidden" name="qty" id="qtyHidden" value="1">
                <input type="hidden" name="totalPrice" id="totalHidden" value="850">
                <input type="hidden" name="notes" id="notesHidden">

                <div class="buttons">
                    <button type="button" class="btn-back" id="backBtn">‚Üê Back</button>
                    <button type="submit" class="btn-pay" id="payBtn">Proceed to Payment ‚Üí</button>
                </div>
            </form>

      </div>
    </div>
  </div>

<script>
  const oilPriceField = document.getElementById('oilPrice');
  const totalField = document.getElementById('totalPrice');
  const productPriceField = document.getElementById('productPrice');
  const qtyField = document.getElementById('qty');
  const decreaseBtn = document.getElementById('decreaseQty');
  const increaseBtn = document.getElementById('increaseQty');
  const notesField = document.getElementById('notes');

  // Hidden inputs (used in POST form)
  const qtyHidden = document.getElementById('qtyHidden');
  const totalHidden = document.getElementById('totalHidden');
  const notesHidden = document.getElementById('notesHidden');

  function updateTotal() {
    const basePrice = parseInt(oilPriceField.value) || 850;
    let qty = parseInt(qtyField.value) || 1;

    if (qty < 1) qty = 1;

    const productTotal = basePrice * qty;

    productPriceField.textContent = '‚Çπ' + productTotal;
    totalField.textContent = '‚Çπ' + productTotal;

    // üëá Save values into hidden fields every time the quantity changes
    qtyHidden.value = qty;
    totalHidden.value = productTotal;
  }

  qtyField.addEventListener('input', updateTotal);

  decreaseBtn.addEventListener('click', (e) => {
    e.preventDefault();
    let qty = parseInt(qtyField.value) || 1;
    if (qty > 1) {
      qtyField.value = qty - 1;
      updateTotal();
    }
  });

  increaseBtn.addEventListener('click', (e) => {
    e.preventDefault();
    let qty = parseInt(qtyField.value) || 1;
    qtyField.value = qty + 1;
    updateTotal();
  });

  // üß† When clicking Pay button ‚Äî make sure all hidden fields are updated correctly
  document.getElementById('payBtn').addEventListener('click', (e) => {
    const name = document.getElementById('custName').value.trim();
    const email = document.getElementById('custEmail').value.trim();
    const phone = document.getElementById('custPhone').value.trim();
    const address = document.getElementById('custAddress').value.trim();
    const notes = notesField.value.trim();

    if (!name || !email || !phone || !address) {
      e.preventDefault();
      alert('Please fill in all required customer details before proceeding to payment.');
      return;
    }

    // ‚úÖ Make sure latest values go into hidden fields
    qtyHidden.value = qtyField.value;
    totalHidden.value = totalField.textContent.replace('‚Çπ', '').trim();
    notesHidden.value = notes;

    alert('Proceeding to secure payment gateway...');
  });

document.getElementById('backBtn').addEventListener('click', (e) => {
  e.preventDefault();
  window.location.href = "{% url 'customer_dashboard' %}";
});


  // initialize totals on page load
  updateTotal();
</script>
</body>
</html>
